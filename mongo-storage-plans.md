# แผนลดพื้นที่ MongoDB แบบเข้าใจง่าย (ข้อความ + รูปภาพ)

## ภาพรวมปัจจุบัน (อธิบายแบบง่าย)
- ระบบเก็บข้อความแชททั้งหมดไว้ในฐานข้อมูล
- รูปที่ลูกค้าส่งเข้ามาถูกแปลงเป็นข้อความยาวมาก (base64) แล้วเก็บไว้ด้วย
- มีการเก็บข้อความซ้ำในอีกคอลเลกชันหนึ่ง และลบเฉพาะบางกรณี
- ไม่มีการตั้งเวลาให้ลบข้อมูลเก่าแบบอัตโนมัติ

## แผน 1: ลดน้อย (เสี่ยงน้อย)
เหมาะกับ: อยากลดลงบ้าง แต่ไม่อยากเปลี่ยนพฤติกรรมระบบ

ทำอะไร
- ตั้งเวลาให้ลบแชทที่เก่ามากอัตโนมัติ (เช่น 90–180 วัน)
- ตั้งเวลาให้ลบประวัติแชทออเดอร์เร็วกว่านั้น (เช่น 7–30 วัน)
- ถ้าข้อความยาวเกินไป (เช่นมีรูปใหญ่) ให้เก็บเป็นข้อความสั้นแทน

ผลที่ได้
- ลดพื้นที่ได้บ้างตามช่วงเวลาที่ตั้งไว้
- ผู้ใช้ยังใช้งานเหมือนเดิม

ผลกระทบ/ข้อเสีย
- แชทเก่ามากจะหายไป
- การลบอัตโนมัติอาจหน่วงเล็กน้อยถ้าข้อมูลเยอะ

## แผน 2: ลดพอดี (สมดุล)
เหมาะกับ: อยากลดพื้นที่ชัดเจน แต่ยังอยากเก็บประวัติแชทข้อความไว้

ทำอะไร
- รูปที่ลูกค้าส่งเข้ามา เก็บเป็นไฟล์รูปไว้ที่อื่น (หรือในโฟลเดอร์) แล้วเก็บแค่ "ตัวอ้างอิง" ในแชท
- ในแชทเก็บเป็น “ข้อความ + บอกว่ามีรูปแนบ” แทนการเก็บรูปทั้งก้อน
- เวลาเรียก AI ให้แปลงรูปเป็น base64 ชั่วคราวตอนใช้งานเท่านั้น
- ลดการเก็บซ้ำในอีกคอลเลกชัน หรือเก็บแค่สรุปออเดอร์
- ตั้งเวลาลบแชทเก่าบางส่วน (เช่น 30–90 วัน)

ผลที่ได้
- ลดพื้นที่ได้มาก โดยเฉพาะถ้ารูปเป็นสาเหตุหลัก
- การใช้งานปัจจุบันแทบไม่เปลี่ยน

ผลกระทบ/ข้อเสีย
- ถ้าเก็บรูปแค่เป็นลิงก์จากที่อื่น แล้วลิงก์หมดอายุ จะดูรูปย้อนหลังไม่ได้
- มีค่าเก็บไฟล์รูปในที่อื่นแทน MongoDB

## แผน 3: ลดเยอะ (ประหยัดที่สุด)
เหมาะกับ: ต้องการลดค่าใช้จ่ายอย่างชัดเจน และยอมแลกกับประวัติเก่า

ทำอะไร
- เก็บเฉพาะแชทล่าสุดต่อผู้ใช้ (เช่น 20–50 ข้อความ) แล้วลบเก่าออก
- สรุปแชทเก่าเป็นข้อความสั้น ๆ แทนเก็บทั้งหมด
- เก็บเฉพาะข้อมูลรูปแบบย่อ (เช่นแค่รายละเอียด) และลบรูปจริงเร็วขึ้น (เช่น 7–14 วัน)
- ยกเลิกการเก็บซ้ำในคอลเลกชันอื่น เหลือเฉพาะข้อมูลออเดอร์

ผลที่ได้
- ลดพื้นที่ได้มากที่สุด
- ฐานข้อมูลโตช้ามาก

ผลกระทบ/ข้อเสีย
- ไม่สามารถย้อนดูบทสนทนาเก่าแบบละเอียดได้
- ถ้าสรุปไม่ดี อาจเสียบริบทในการดูย้อนหลัง

## แผน 4: แยกเก็บเพื่อความปลอดภัย/กฎหมาย
เหมาะกับ: ต้องลดข้อมูลส่วนตัว แต่ยังอยากมีสถิติเพื่อธุรกิจ

ทำอะไร
- เก็บแชทจริงไว้ระยะสั้น แล้วลบอัตโนมัติ
- เก็บเฉพาะ “ตัวเลขสถิติ” เช่น จำนวนข้อความ เวลาใช้งาน สถานะคำสั่งซื้อ
- ทำให้ข้อมูลส่วนตัวอ่านย้อนกลับไม่ได้ (เช่นเข้ารหัสหรือแฮช)
- เก็บรูปไว้ในที่ที่ควบคุมสิทธิ์เข้าถึงได้ และลบตามเวลา

ผลที่ได้
- ลดความเสี่ยงเรื่องข้อมูลส่วนตัว
- ค่าเก็บข้อมูลลดลงมาก

ผลกระทบ/ข้อเสีย
- ดูรายละเอียดแชทย้อนหลังไม่ได้
- ต้องตั้งนโยบายและกระบวนการชัดเจน

## หมายเหตุเรื่องรูป (เข้าใจง่าย)
- รูปที่ถูกแปลงเป็นข้อความยาว (base64) จะใหญ่กว่ารูปจริงประมาณ 1.3 เท่า
- ถ้าเก็บรูปซ้ำ 2 ที่ ขนาดจะโตขึ้นอีกเกือบเท่าตัว

## เลือกแผนให้เร็ว
- อยากเปลี่ยนน้อยที่สุด: แผน 1
- อยากลดพื้นที่เยอะพอสมควร: แผน 2
- อยากลดแรงที่สุด: แผน 3
- โฟกัสความเป็นส่วนตัว: แผน 4
